' Dump URL Handlers
' Enumerats all the URL Handlers registered on the system
' Executes the command cscript.exe //Nologo DUH.vbs
'
' satebac

On Error Resume Next
Const HKCR = &H80000000
Dim wsh
Dim comment
Dim command
Dim isHandler

set wsh = WScript.CreateObject("WScript.Shell:")
set oReg = GetObject("winmgmts:{impersonationLevel=impersonate} !\\.\root\default:StdRegProv")

ret = oReg.EnumKey(HKCR, "/", arrSubKeys)

if ret<>0 Then
	ret = oReg.EnumKey(HKCR, "", arrSubKeys)
end if

if ret=0 and IsArray(arrSubKeys) Then
	For Each subkey In arrSubKeys
		isHandler = wsh.RegRead("HKCR\" & subkey & "\URL Protocol")
		if Err=0 Then
			comment = wsh.RegRead("HKCR\" & subkey & "\")
			command = wsh.RegRead("HKCR\" & subkey & "\shell\open\command\")
			Wscript.Echo subkey & Chr(&H09) & comment & Chr(&H09) & command
		else
			Err = 0
		end if
	Next
else
	WScript.Echo "[*] An error has occurred ret=" & ret & " err=" & Err & " " & IsArray(arrSubKeys)
	WScript.Echo "[*] Look for the ret code in winerror.h"
end if
